(this["webpackJsonpexistential-graphs"]=this["webpackJsonpexistential-graphs"]||[]).push([[0],{15:function(e){e.exports=JSON.parse('{"binary":{"<->":"\\\\leftrightarrow","%":"\\\\leftrightarrow","->":"\\\\rightarrow","$":"\\\\rightarrow","&":"\\\\land","^":"\\\\land","|":"\\\\lor"},"unary":{"~":"\\\\lnot","!":"\\\\lnot"},"symb":{"^":"\\\\bot"},"eg":{"<->":"($1($2))(($1)$2)","%":"($1($2))(($1)$2)","->":"($1($2))","$":"($1($2))","&":"$1$2","|":"(($1)($2))"}}')},27:function(e,t,n){e.exports=n(62)},32:function(e,t,n){},33:function(e,t,n){},38:function(e,t,n){},60:function(e,t,n){},61:function(e,t,n){},62:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(14),s=n.n(i),o=(n(32),n(3)),c=n(4),u=n(1),l=n(6),h=n(5),d=(n(33),n(7)),p=n.n(d),f=n(26),v=n(11),m=n(8),g=n(15),b=g.binary,y=g.unary;function k(e){return"(?:"+(e=e.map((function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}))).join("|")+")"}var C=k(Object.keys(y)),S="^(".concat(C,"*[A-Za-z]+|").concat(C,"*\\((.*)\\))(").concat(k(Object.keys(b)),")(").concat(C,"*[A-Za-z]+|").concat(C,"*\\((.*)\\))$"),E=new RegExp(S),O=new RegExp("^([A-Za-z])*"),x=new RegExp("^".concat(C,"*\\((.*)\\)$"));var w=function(e){return function e(t){var n;return!!t.match(O)||(null!==(n=E.exec(t))?null!=n&&(n[2]&&n[5]?e(n[2])&&e(n[5]):n[2]?e(n[2]):!n[5]||e(n[5])):null!==(n=x.exec(t))?e(n[1]):void 0)}(e=e.replace(/\s/g,""))},j=n(15);function D(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var N=Object.keys(j.binary);N=N.map((function(e){return D(e)}));var I=new RegExp("(?:"+N.join("|")+")","g"),P=j.unary,z=function(e){if("string"===typeof e||e instanceof String){var t;for(e=e.replace(/\s/g,"");null!==(t=I.exec(e));)e=e.substr(0,t.index)+j.binary[t[0]]+" "+e.substr(t.index+t[0].length);for(var n in Object.keys(P))t=Object.keys(P)[n],e=e.replace(new RegExp(D(t),"g"),P[t]+" ");return e=e.replace(/[^()A-Za-z\\\s]/g,"")}return""};var F=function e(t){if(!w(t))return null;if(("string"===typeof t||t instanceof String)&&w(t)){t=t.replace(/\s/g,"");var n=E.exec(t),a=(x.exec(t),O.exec(t));if(n){var r=e(n[1]),i=e(n[4]);return j.eg[n[3]].replace(/\$1/g,r).replace(/\$2/g,i)}if("("===t[0]){var s=e(t.substr(1,t.length-2));return s||null}if(Object.keys(P).includes(t[0])){var o=e(t.substr(1));return o?"("+o+")":null}return a?"{"+a[0]+"}":null}return null},R=function(e){if("string"===typeof e||e instanceof String){var t=function(t){return e.length>0&&t===e[0]&&(e=e.substring(1),!0)};return function n(a){for(var r=[];;){if(t("(")){if(r.push(n(e)),!t(")"))return null}else if(t("{")){for(var i="";e.length>0&&!t("}");)i=i.concat(e[0]),e=e.substring(1);0===i.length&&r.push("\xa0"),r.push(i)}if(0===e.length||"("!==e[0]&&"{"!==e[0])break}return r}()}return null};console.log(R("((({P}(({Q}({R})))))({T}))({T}){P}"));var M=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={selected:null,functions:[{str:"Iterate",func:"iteration"},{str:"Deiterate",func:"deiteration"},{str:"Wrap in Double Cut",func:"doubleCutEnclose"},{str:"Add Double Cut",func:"doubleCutAdd"},{str:"Remove Double Cut",func:"doubleCutRemove"},{str:"Insertion",func:"insertion"},{str:"Erasure",func:"erasure"}]},a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this,t=this.props,n=t.hidden,a=t.modifyCanvas,i=t.cancelSelection,s=this.state.selected;return n?r.a.createElement(r.a.Fragment,null):r.a.createElement("div",{className:"toolbox",ref:this.canvas},r.a.createElement("h3",null,"Tools"),this.state.functions.map((function(t,n){return r.a.createElement("div",{className:"tool",style:s===n?{backgroundColor:"#AFAFAA"}:{},onClick:function(){e.state.selected===n?(e.setState({selected:null}),i()):(e.setState({selected:n}),a(t.func,(function(){})))}},t.str)})))}}]),n}(r.a.Component),A=n(9),H=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).performRedo=a.performRedo.bind(Object(u.a)(a)),a.performUndo=a.performUndo.bind(Object(u.a)(a)),a.state={},a}return Object(c.a)(n,[{key:"handleClick",value:function(e,t,n){e.preventDefault(),n||this.props.setStep(t)}},{key:"performUndo",value:function(e){var t=this.props.state,n=t.changeHistory,a=t.steps,r=t.redoHistory,i=n.pop();i&&(r.push(a),this.props.setState(n,i.steps,r))}},{key:"performRedo",value:function(e){var t=this.props.state,n=t.changeHistory,a=t.steps,r=t.redoHistory,i=r.pop();i&&(n.push({redoHistory:r,steps:a}),this.props.setState(n,i,r))}},{key:"getColor",value:function(e){return e?"rgb(136, 136, 136)":"rgb(68, 68, 68)"}},{key:"disable",value:function(e,t){return e.concat(t.length>0?"":" disabled")}},{key:"render",value:function(){var e=this,t=this.props,n=t.hide,a=t.currentStep,i=t.stepInfo,s=t.state,o=s.changeHistory,c=s.redoHistory;if(n)return r.a.createElement(r.a.Fragment,null);var u=a===i.length-1,l=0===a;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"step-menu"},r.a.createElement("div",{style:{color:this.getColor(l)}},r.a.createElement("div",{onClick:function(t){return e.handleClick(t,0,l)}},r.a.createElement(A.a,{src:"/existential-graphs/assets/step-first.svg"})),r.a.createElement("div",{onClick:function(t){return e.handleClick(t,a-1,l)}},r.a.createElement(A.a,{src:"/existential-graphs/assets/step-prev.svg"}))),r.a.createElement("div",null,r.a.createElement("div",{className:this.disable("undo-btn",o),onClick:this.performUndo},r.a.createElement("div",{className:"undo-svg"},r.a.createElement(A.a,{src:"/existential-graphs/assets/undo.svg"}))),r.a.createElement("div",{className:this.disable("redo-btn",c),onClick:this.performRedo},r.a.createElement("div",{className:"redo-svg"},r.a.createElement(A.a,{src:"/existential-graphs/assets/redo.svg"})))),r.a.createElement("div",{style:{color:this.getColor(u)}},r.a.createElement("div",{onClick:function(t){return e.handleClick(t,a+1,u)}},r.a.createElement(A.a,{src:"/existential-graphs/assets/step-next.svg"})),r.a.createElement("div",{onClick:function(t){return e.handleClick(t,i.length-1,u)}},r.a.createElement(A.a,{src:"/existential-graphs/assets/step-last.svg"})))),r.a.createElement("div",{className:"step-text"},"Step ",a+1," of ",i.length))}}]),n}(r.a.Component),L={gridSize:1,cutPadding:{horizontal:10,vertical:5},cutCornerRadius:10,initialSeparation:50},$=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).text=r.a.createRef(),a.getCoords=a.props.getCoords,a.handleClick=a.handleClick.bind(Object(u.a)(a)),a.state={x:e.x,y:e.y,cursorOver:!1,dragging:!1},a.panzoom=a.props.panzoom,window.addEventListener("mousemove",a.onMouseMove.bind(Object(u.a)(a))),window.addEventListener("mousedown",a.handleDragStart.bind(Object(u.a)(a))),window.addEventListener("mouseup",a.handleDragEnd.bind(Object(u.a)(a))),window.addEventListener("click",a.handleClick),a}return Object(c.a)(n,[{key:"handleClick",value:function(){this.state.cursorOver&&this.props.enableHighlight&&this.props.selectedCallback&&(this.props.selectedCallback(this.props.id),this.setState({cursorOver:!1}))}},{key:"componentDidMount",value:function(){var e=this;this.text.current.style.cursor="pointer",this.props.subscribeMove((function(t,n){var a=e.state.x+t,r=e.state.y+n;e.props.setCoords(a,r),e.setState({x:a,y:r})}))}},{key:"handleDragStart",value:function(e){this.state.cursorOver&&(this.panzoom.pause(),this.setState({dragging:!0}))}},{key:"handleDragEnd",value:function(e){this.panzoom.resume();var t=this.state,n=t.x,a=t.y;this.props.setCoords(n,a),this.setState({dragging:!1})}},{key:"onMouseMove",value:function(e){if(this.state.dragging){var t=this.getCoords(e.clientX,e.clientY),n=t.x,a=t.y;n=Math.round(n/L.gridSize)*L.gridSize,a=Math.round(a/L.gridSize)*L.gridSize,this.props.setCoords(n,a),this.setState({x:n,y:a})}}},{key:"componentWillUnmount",value:function(){window.removeEventListener("click",this.handleClick),window.removeEventListener("mousemove",this.onMouseMove.bind(this)),window.removeEventListener("mousedown",this.handleDragStart.bind(this)),window.removeEventListener("mouseup",this.handleDragEnd.bind(this))}},{key:"render",value:function(){var e=this,t=this.state.cursorOver&&this.props.enableHighlight,n=null!=this.props.selectedCallback&&this.state.cursorOver&&!this.props.enableHighlight,a="black";return t?a="blue":n&&(a="red"),r.a.createElement("text",{className:"noselect",x:this.state.x,y:this.state.y,id:this.props.id,fill:a,onMouseEnter:function(){return e.setState({cursorOver:!0})},onMouseLeave:function(){return e.setState({cursorOver:!1})},ref:this.text},this.props.children)}}]),n}(r.a.Component),B=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).cut=r.a.createRef(),a.BB=r.a.createRef(),a.getBBoxData=a.getBBoxData.bind(Object(u.a)(a)),a.handleClick=a.handleClick.bind(Object(u.a)(a)),a.update=a.update.bind(Object(u.a)(a)),a.getCoords=a.props.getCoords,a.state={highlight:!1,cursorOver:!1,bounding:{_x:0,_y:0,_w:0,_h:0}},a.panzoom=a.props.panzoom,window.addEventListener("click",a.handleClick),window.addEventListener("mousemove",a.onMouseMove.bind(Object(u.a)(a))),window.addEventListener("mousedown",a.handleDragStart.bind(Object(u.a)(a))),window.addEventListener("mouseup",a.handleDragEnd.bind(Object(u.a)(a))),a}return Object(c.a)(n,[{key:"handleClick",value:function(){this.state.cursorOver&&this.props.enableHighlight&&this.props.selectedCallback&&(this.props.selectedCallback(this.props.id),this.setState({cursorOver:!1}))}},{key:"getBBoxData",value:function(){if(this.cut.current){var e=this.cut.current.getBBox(),t=e.x,n=e.y,a=e.width,r=e.height;return{_x:t-L.cutPadding.horizontal,_y:n-L.cutPadding.vertical,_w:a+2*L.cutPadding.horizontal,_h:r+2*L.cutPadding.vertical}}return{}}},{key:"update",value:function(){var e=this;this.interval||(this.interval=setInterval((function(){e.setState({bounding:e.getBBoxData()})}),1),setTimeout((function(){clearInterval(e.interval),e.interval=null}),100))}},{key:"componentDidMount",value:function(){this.update()}},{key:"componentDidUpdate",value:function(){this.update()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("click",this.handleClick),this.interval&&clearInterval(this.interval)}},{key:"handleDragStart",value:function(e){if(this.state.cursorOver){this.panzoom.pause();var t=this.getCoords(e.clientX,e.clientY),n=t.x,a=t.y;this.setState({dragging:!0,x:n,y:a})}}},{key:"handleDragEnd",value:function(e){this.panzoom.resume(),this.setState({dragging:!1})}},{key:"onMouseMove",value:function(e){if(this.state.dragging){var t=this.state.x,n=this.state.y,a=this.getCoords(e.clientX,e.clientY),r=a.x,i=a.y;r=Math.round(r/L.gridSize)*L.gridSize,i=Math.round(i/L.gridSize)*L.gridSize,this.props.setCoords(r-t,i-n),this.setState({x:r,y:i})}}},{key:"render",value:function(){var e=this,t=this.state.cursorOver&&this.props.enableHighlight,n=null!=this.props.selectedCallback&&this.state.cursorOver&&!this.props.enableHighlight,a="black";t?a="blue":n&&(a="red");var i=this.state.bounding,s=i._x,o=i._y,c=i._w,u=i._h;return r.a.createElement(r.a.Fragment,null,r.a.createElement("rect",{x:s,y:o,width:c,height:u,fillOpacity:"0.7",strokeOpacity:"1",stroke:a,fill:t?"#DFDFDA":"white",onMouseEnter:function(t){return e.setState({cursorOver:!0})},onMouseLeave:function(t){return e.setState({cursorOver:!1})},rx:L.cutCornerRadius.toString(),ry:L.cutCornerRadius.toString()}),r.a.createElement("g",{ref:this.cut},this.props.children))}}]),n}(r.a.Component),T=(n(38),n(24)),V=n.n(T),W=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e=this.props.menuItems;return r.a.createElement("div",{className:"dropdown-menu"},e.map((function(e){return e.title?r.a.createElement("div",{className:"menu-title",onClick:e.func},e.title):r.a.createElement("div",{className:e})})))}}]),n}(r.a.Component),G=n(16).nanoid,_=function(e){var t=e.state,n=e.getSelection,a=e.getInsertionPoint,r=e.requestInput,i=e.initXY;return{state:t,insertion:function(){var e=Object(m.a)(p.a.mark((function e(){var n,s,o,c,u,l,h,d,f,m,g,b,y,k;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.state,s=n.steps,o=n.currentStep,c=n.data,u=this.copyStep(s[o]),e.next=4,a({cut:"even",canvas:!1});case 4:if((l=e.sent)&&l.id){e.next=7;break}return e.abrupt("return",null);case 7:return h=l.id,d=l.x,f=l.y,e.next=10,r();case 10:if(null!=(m=e.sent)&&m){e.next=13;break}return e.abrupt("return",null);case 13:if(g=i(R(m),t.data[h].level+1),(b=this.findID(u,h)).data){e.next=18;break}return console.log("Insert ID could not be found in Iterate"),e.abrupt("return",null);case 18:for(y in b.data=b.data.concat(g.stepZero.data),g.data)"var"===(k=g.data[y]).type&&(k.x+=d,k.y+=f);return s.push(u),e.abrupt("return",{steps:s,currentStep:o+1,data:Object(v.a)({},c,{},g.data)});case 22:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),iteration:function(){var e=Object(m.a)(p.a.mark((function e(){var t,r,i,s,o,c,u,l,h,d,f,v,m,g;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n({cut:"all",var:"all"});case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",null);case 5:return e.next=7,a();case 7:if(r=e.sent){e.next=10;break}return e.abrupt("return",null);case 10:if(i=r.id,s=r.x,o=r.y,c=i){e.next=14;break}return e.abrupt("return",null);case 14:if(u=this.state,l=u.steps,h=u.currentStep,d=u.data,f=this.copyStep(l[h]),this.isInNestedGraph(f,c,t)){e.next=20;break}if(c===this.findParent(f,t).id){e.next=20;break}return console.log("Insert selection is not in a subgraph of Copy selection"),e.abrupt("return",null);case 20:if(v=this.copyContents(this.findID(f,t))){e.next=24;break}return console.log("Copy ID could not be found in Iterate"),e.abrupt("return",null);case 24:if((m=this.findID(f,c)).data){e.next=28;break}return console.log("Insert ID could not be found in Iterate"),e.abrupt("return",null);case 28:return m.data=m.data.concat(v),g=v,"string"!==typeof v&&(g=v.id),d[g].x=s,d[g].y=o,h+=1,l.push(f),e.abrupt("return",{steps:l,currentStep:h,data:d});case 36:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),deiteration:function(){var e=Object(m.a)(p.a.mark((function e(){var t,a,r,i,s,o,c,u,l,h,d=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state,a=t.steps,r=t.currentStep,i=t.data,s=this.copyStep(a[r]),e.next=4,n({cut:"all",var:"all"});case 4:if(o=e.sent){e.next=7;break}return e.abrupt("return",null);case 7:if(c=this.findID(s,o)){e.next=10;break}return e.abrupt("return",null);case 10:if(u=function e(t,n){if("string"===typeof t)return"string"===typeof n&&i[t].var===i[n].var;var a=[];return t.data.map((function(t){return function(t,n){for(var r in n.data)if(!a.includes(r)&&e(t,n.data[r]))return!0;return!1}(t,n)})).every(Boolean)},function e(t,n){for(var a in t.data){var r=t.data[a];if("string"===typeof n&&"string"===typeof r&&r!==n&&i[n].var===i[r].var)return!0;if(r.id!==n.id&&u(r,n))return!0}return!!t.id&&e(d.findParent(s,t.id),n)}(this.findParent(s,o),c)){e.next=15;break}return e.abrupt("return",null);case 15:if(l=this.findParent(s,o)){e.next=18;break}return e.abrupt("return",null);case 18:if(!((h=l.data.indexOf(c))>-1)){e.next=23;break}l.data.splice(h,1),e.next=24;break;case 23:return e.abrupt("return",null);case 24:return a.push(s),r+=1,e.abrupt("return",{steps:a,currentStep:r,data:i});case 27:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),erasure:function(){var e=Object(m.a)(p.a.mark((function e(){var t,a,r,i,s,o,c,u,l;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n({cut:"even",var:"even"});case 2:if(null!=(t=e.sent)){e.next=5;break}return e.abrupt("return",null);case 5:if(a=this.state,r=a.steps,i=a.currentStep,s=a.data,o=this.copyStep(r[i]),c=this.findID(o,t)){e.next=10;break}return e.abrupt("return",null);case 10:if(u=this.findParent(o,t)){e.next=13;break}return e.abrupt("return",null);case 13:if(!((l=u.data.indexOf(c))>-1)){e.next=18;break}u.data.splice(l,1),e.next=19;break;case 18:return e.abrupt("return",null);case 19:return i+=1,r.push(o),e.abrupt("return",{steps:r,currentStep:i,data:s});case 22:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),doubleCutEnclose:function(){var e=Object(m.a)(p.a.mark((function e(){var t,a,r,i,s,o,c,u,l,h,d,f,v;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n({cut:"all",var:"all"});case 2:if(t=e.sent,a=this.state,r=a.steps,i=a.currentStep,s=a.data,o=this.copyStep(r[i]),c=this.findID(o,t)){e.next=8;break}return e.abrupt("return",null);case 8:if(u=G(),l=G(),h={data:[{data:[c],id:l,type:"cut"}],id:u,type:"cut"},d=s[t].level,s[l]={type:"cut",level:d+1},s[u]={type:"cut",level:d},this.changeCutLevel(o,t,2),f=this.findParent(o,t)){e.next=19;break}return e.abrupt("return",null);case 19:return(v=f.data.indexOf(c))>-1&&f.data.splice(v,1),f.data=f.data.concat(h),i+=1,r.push(o),e.abrupt("return",{steps:r,currentStep:i,data:s});case 25:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),doubleCutAdd:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,r,i,s,o,c,u,l,h,d,f,v,m;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a();case 2:if(t=e.sent,n=t.id,r=t.x,i=t.y,r&&i){e.next=8;break}return e.abrupt("return",null);case 8:return s=this.state,o=s.steps,c=s.currentStep,u=s.data,l=this.copyStep(o[c]),h=G(),d=G(),f=G(),v={data:[{data:[f],id:d,type:"cut"}],id:h,type:"cut"},m=n?u[n].level:-1,u[d]={type:"cut",level:m+2},u[h]={type:"cut",level:m+1},u[f]={x:r,y:i,type:"emptyvar",var:"\xa0",level:m+3},n?this.findID(l,n).data.push(v):l.data.push(v),c+=1,o.push(l),e.abrupt("return",{steps:o,currentStep:c,data:u});case 23:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),doubleCutRemove:function(){var e=Object(m.a)(p.a.mark((function e(){var t,a,r,i,s,o,c,u,l,h,d;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n({cut:"all"});case 2:if(t=e.sent,a=this.state,r=a.steps,i=a.currentStep,s=a.data,o=this.copyStep(r[i]),!(c=this.findID(o,t))||"cut"!==c.type){e.next=25;break}if(!(u=c.data)||1!==u.length||"cut"!==u[0].type){e.next=22;break}if(l=u[0].data,h=this.findParent(o,t)){e.next=13;break}return e.abrupt("return",null);case 13:return this.changeCutLevel(o,u[0].id,-2),(d=h.data.indexOf(c))>-1&&h.data.splice(d,1),h.data=h.data.concat(l),i+=1,r.push(o),e.abrupt("return",{steps:r,currentStep:i,data:s});case 22:return e.abrupt("return",null);case 23:e.next=26;break;case 25:return e.abrupt("return",null);case 26:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),isInNestedGraph:function(e,t,n){var a=this.findParent(e,n);return a?!!this.findID(a,t)||(console.log("Child is not in nested graph of Parent"),!1):(console.log("Parent Data could not be found"),!1)},copyContents:function(e){var t=this.state.data;function n(e,n){if("string"===typeof e){var r=G();return t[r]={type:"var",var:t[e].var,x:t[e].x,y:t[e].y,level:t[e].level},r}var i={};for(var s in e)if("id"===s){var o=G();i[s]=o,t[o]={type:"cut",level:n}}else i[s]="data"!==s?e[s]:a(e[s],n+1);return i}function a(e,a){var r=[];for(var i in e)if("string"===typeof e[i]){var s=G();r.push(s),t[s]={type:"var",var:t[e[i]].var,x:t[e[i]].x,y:t[e[i]].y,level:t[e[i]].level}}else r.push(n(e[i],a));return r}var r=n(e,0);return this.state.data=t,r},changeCutLevel:function(e,t,n){var a=this.state.data;if(a[t]&&"var"===a[t].type)a[t].level+=n;else{var r=!1;s(e.data),this.state.data=a}function i(e){var i;e.id&&(i=e.id)===t&&(r=!0),r&&(a[i].level+=n),e.data&&s(e.data)}function s(e){for(var t in e)"string"!==typeof e[t]?i(e[t]):r&&(a[e[t]].level+=n)}},copyStep:function(e){var t={};function n(e){var t={};for(var n in e)"string"===typeof e[n]?t[n]=e[n]:t[n]=a(e[n]);return t}function a(e){var t=[];for(var a in e)"string"===typeof e[a]?t.push(e[a]):t.push(n(e[a]));return t}return t.data=a(e.data),t.h=e.h,t.w=e.w,t},findParent:function(e,t){var n=e;function a(e){for(var n in e)if("string"===typeof e[n]){if(e[n]===t)return!0}else{if(e[n].id&&e[n].id===t)return!0;r(e[n])}return!1}function r(e){e.data&&a(e.data)&&(n=e)}return a(e.data),n},findID:function(e,t){function n(e){for(var n in e)if("string"===typeof e[n]){if(e[n]===t)return t}else{if(e[n].id===t)return e[n];var r=a(e[n]);if(r)return r}}function a(e){if("string"===typeof e)return e===t?e:void 0;for(var a in e){if(e[a]instanceof Array)return n(e[a]);if("id"===a&&e[a]===t)return e}}return a(e)},offsetPosition:function(e,t,n){this.findID(t,n);return console.log(e),e}}},U=n(25),J=(n(20),n(10)),Z=n.n(J),X=n(16).nanoid;function Y(e,t){t||(t=0);var n={},a=0,r=0,i=0;return{stepZero:{data:function e(t,s,o){for(var c in t)if(t[c]instanceof Array&&t[c].length>0){var u=X();t[c]={data:e(t[c],s+1),id:u,type:"cut"},n[u]={type:"cut",level:s}}else{var l=a,h=X();n[h]={type:"var",var:t[c],x:Math.round(l/L.gridSize)*L.gridSize,y:Math.round(0/L.gridSize)*L.gridSize,level:s},t[c]=h,i=0>i?0:i,r=l>r?l:r,a+=L.initialSeparation}return t}(e,t),h:i,w:r},data:n}}var q=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var a;Object(o.a)(this,n),(a=t.call(this,e)).canvas=r.a.createRef(),a.canvasContainer=r.a.createRef(),a.renderStep=a.renderStep.bind(Object(u.a)(a)),a.checkLevelIntegrity=a.checkLevelIntegrity.bind(Object(u.a)(a)),a.changePos=a.changePos.bind(Object(u.a)(a)),a.getSVGCoords=a.getSVGCoords.bind(Object(u.a)(a)),a.highlightCut=a.highlightCut.bind(Object(u.a)(a)),a.modifyCanvas=a.modifyCanvas.bind(Object(u.a)(a)),a.getInsertionPoint=a.getInsertionPoint.bind(Object(u.a)(a)),a.requestInput=a.requestInput.bind(Object(u.a)(a)),a.cancelSelection=a.cancelSelection.bind(Object(u.a)(a)),a.createElement=a.createElement.bind(Object(u.a)(a)),a.clickedCanvas=a.clickedCanvas.bind(Object(u.a)(a)),a.initXY=Y,a.moveVars={},a.getSelection=a.getSelection.bind(Object(u.a)(a));var i=a.props.proof,s=i.premises,c=i.conclusion,l=i.steps,h=i.data,d=i.changeHistory;return a.state={proof:{premises:s,conclusion:c},changeHistory:d||[],redoHistory:[],steps:l||[],data:h||{},currentStep:0!==l.length?l.length-1:0,moveListeners:[],highlights:{cut:"none",var:"none",canvas:!1},cbFunction:null,finishCB:null,interaction:!0,functions:{insertion:function(){return _(Object(u.a)(a)).insertion()},erasure:function(){return _(Object(u.a)(a)).erasure()},iteration:function(){return _(Object(u.a)(a)).iteration()},deiteration:function(){return _(Object(u.a)(a)).deiteration()},doubleCutRemove:function(){return _(Object(u.a)(a)).doubleCutRemove()},doubleCutEnclose:function(){return _(Object(u.a)(a)).doubleCutEnclose()},doubleCutAdd:function(){return _(Object(u.a)(a)).doubleCutAdd()}},formula:"",eg:"",fitchNotation:!1},a}return Object(c.a)(n,[{key:"getInsertionPoint",value:function(e){var t=this,n=new Promise((function(e,n){t.setState({canvasCb:function(n,a){t.setState({canvasCb:null}),setTimeout((function(){t.state.cbFunction?(t.state.cbFunction(null),t.setState({cbFunction:null},(function(){return e({x:n,y:a})}))):e({x:n,y:a})}),50)}})}));return new Promise(function(){var a=Object(m.a)(p.a.mark((function a(r,i){var s;return p.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Promise.all([t.getSelection(Object(v.a)({cut:"all",var:"none",canvas:!0},e)),n]);case 2:s=a.sent,t.state.finishCB&&t.state.finishCB(),t.setState({highlights:{cut:"none",var:"none",canvas:!1},finishCB:null,canvasCb:null,interaction:!0,cbFunction:null},(function(){var e=Object(f.a)(s,2),t=e[0],n=e[1],a=n.x,i=n.y;r({id:t,x:a,y:i})}));case 5:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}())}},{key:"getSelection",value:function(e){var t=this;return new Promise((function(n,a){var r=t.state,i=r.steps;r.currentStep+1===i.length&&t.setState({highlights:e,interaction:!1,cbFunction:function(e){t.setState({highlights:{cut:"none",var:"none",canvas:!1},interaction:!0,cbFunction:null},(function(){return n(e)}))}})}))}},{key:"modifyCanvas",value:function(e,t){var n=this,a=this.state,r=a.steps,i=a.changeHistory;(i=i.slice()).push({steps:Array.from(r)}),this.setState({finishCB:t},(function(){n.state.functions[e]().then((function(t){n.state.finishCB&&n.state.finishCB(),t&&n.setState(Object(v.a)({changeHistory:i,redoHistory:[]},t),(function(){n.checkLevelIntegrity(),n.modifyCanvas(e,(function(){}))}))}))}))}},{key:"checkLevelIntegrity",value:function(){var e=this.state,t=e.steps,n=e.data,a=e.currentStep,r=t[a];t[a].data=function e(t,a){for(var r in t){var i=t[r],s=[];for(var o in i.type&&"cut"===i.type?(t[r].data=e(i.data,a+1),n[t[r].id].level=a,s.push(i.id)):s.push(i),s)n[s[o]].level=a}return t.length>1&&(t=t.filter((function(e){return e.id||!e.id&&"\xa0"!==n[e].var}))),t}(r.data,0),this.setState({steps:t,data:n})}},{key:"cancelSelection",value:function(){var e=this.state,t=e.cbFunction,n=e.canvasCb,a=e.finishCB;t&&t(),n&&n(),a&&a()}},{key:"changePos",value:function(e,t,n){var a=this.state.data;Object.assign(a[e],{x:t,y:n}),this.setState(a)}},{key:"highlightCut",value:function(e){if("all"===this.state.highlights.cut)return!0;var t=!1;return e%2===1&&(t=!0),!("odd"!==this.state.highlights.cut||!t)||"even"===this.state.highlights.cut&&!t}},{key:"highlightVar",value:function(e){if("all"===this.state.highlights.var)return!0;var t=!1;return e%2===1&&(t=!0),!("odd"!==this.state.highlights.var||!t)||"even"===this.state.highlights.var&&!t}},{key:"createElement",value:function(e,t,n,a,r){var i=this.state.data,s=X();i[s]={},i[s].x=a||0,i[s].y=r||0,i[s].type=t,i[s].var=e,n.push(s),this.setState({data:i})}},{key:"removeElement",value:function(e){this.state.steps[this.state.currentStep].push(e)}},{key:"renderStep",value:function(e){var t=this,n=this.state.data,a=this.state.steps[e];if(a){var i=function(e,n,a){var r=t.state.data;r[e].x=n,r[e].y=a,t.setState({data:r})},s=function e(a){var s=[];0===a.length&&t.createElement("\xa0","emptyvar",a,0,0);var o=function(o){if("cut"===a[o].type){var c=n[a[o].id].level,u=[];!function e(t){if(t.data)for(var n in t.data)e(t.data[n]);else u.push(t)}(a[o]);var l=r.a.createElement(B,{level:c,enableHighlight:t.highlightCut(c),id:a[o].id,panzoom:t.panzoom,getCoords:t.getSVGCoords,setCoords:function(e,n){u.forEach((function(a){t.moveVars[a](e,n)}))},key:a[o].id,selectedCallback:t.state.cbFunction},e(a[o].data));s.push(l)}else if("var"===t.state.data[a[o]].type){var h=t.state.data[a[o]],d=n[a[o]].level;s.unshift(r.a.createElement($,{x:h.x,y:h.y,id:a[o],enableHighlight:t.highlightVar(d),selectedCallback:t.state.cbFunction,panzoom:t.panzoom,interaction:t.state.interaction||t.highlightVar(d),getCoords:t.getSVGCoords,setCoords:function(e,t){return i(a[o],e,t)},subscribeMove:function(e){return t.moveVars[a[o]]=e},key:a[o]},h.var))}else if("emptyvar"===t.state.data[a[o]].type&&1===a.length){var p=t.state.data[a[o]];s.unshift(r.a.createElement($,{x:p.x,y:p.y,id:a[o],enableHighlight:!1,selectedCallback:function(){},panzoom:t.panzoom,interaction:t.state.interaction,getCoords:t.getSVGCoords,setCoords:function(e,t){return i(a[o],e,t)},subscribeMove:function(e){return t.moveVars[a[o]]=e},key:a[o]},p.var))}};for(var c in a)o(c);return s};return s.bind(this),s(a.data)}}},{key:"componentDidMount",value:function(){this.panzoom=V()(this.canvas.current,{maxZoom:6,minZoom:.5});var e=Math.max(document.documentElement.clientWidth,window.innerWidth||0),t=Math.max(document.documentElement.clientHeight,window.innerHeight||0),n=this.state.steps;if(0===n.length){var a=this.state.proof.premises;console.log(a),console.log(a.join("")),console.log(R(a.join("")));var r=Y(R(a.join("")),0),i=r.stepZero,s=r.data;n.push(i),this.setState({steps:n,data:s})}this.setState({});var o=this.state.steps[this.state.currentStep];this.panzoom.moveTo(e/2-o.w,t/2-o.h),this.panzoom.zoomTo(e/2-o.w,t/2-o.h,2)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this)}},{key:"getSVGCoords",value:function(e,t){var n=this.canvasContainer.current.createSVGPoint();return n.x=e,n.y=t,n.matrixTransform(this.canvas.current.getScreenCTM().inverse())}},{key:"clickedCanvas",value:function(e){if(this.state.canvasCb){var t=this.getSVGCoords(e.pageX,e.pageY),n=t.x,a=t.y;this.state.canvasCb(n,a)}}},{key:"requestInput",value:function(){var e=this;return new Promise((function(t,n){e.setState({showOverlay:!0,cbFunction:function(n){t(null==n?null:n),e.setState({showOverlay:!1,cbFunction:null})}})}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.proof,a=t.data,i=t.steps,s=t.currentStep,o=(t.highlight,t.showOverlay),c=t.changeHistory;this.props.saveProof(Object(v.a)({},n,{data:a,steps:i,changeHistory:c}));var u=function(){};this.panzoom&&(u=this.panzoom.zoomWithWheel);var l=z(this.state.formula),h=F(this.state.formula);return r.a.createElement(U.CSSTransitionGroup,{transitionName:"fadein",transitionAppear:!0,transitionAppearTimeout:500,transitionEnter:!1,transitionLeaveTimeout:300},r.a.createElement("div",{className:"insertOverlay".concat(o?" shown":"")},r.a.createElement("h2",null,"Fitch-Style Formula to Insert"),!1,r.a.createElement("div",null,r.a.createElement("table",null,r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",{style:{width:"40%"}},r.a.createElement("input",{onChange:function(t){return e.setState({formula:t.target.value,eg:F(t.target.value)})}})),r.a.createElement("td",null,l&&r.a.createElement(Z.a,{math:l}))),r.a.createElement("tr",null))),"To insert: ",h&&r.a.createElement(Z.a,{math:h})),!1,r.a.createElement("span",{className:"buttons"},r.a.createElement("button",{onClick:function(){return e.state.cbFunction(e.state.eg)}},"Insert"),r.a.createElement("button",{onClick:function(){return e.state.cbFunction(null)}},"Cancel"))),r.a.createElement("div",{key:"main-div",className:"mainCanvas noselect".concat(o?" disabled":"")},r.a.createElement(W,{menuItems:this.props.menuItems}),r.a.createElement(M,{hidden:s+1!==i.length,functions:this.state.functions,modifyCanvas:this.modifyCanvas,cancelSelection:this.cancelSelection}),r.a.createElement("svg",{ref:this.canvasContainer,className:"canvas noselect",onWheel:u,onClick:this.clickedCanvas,onMouseEnter:function(){return e.setState({highlight:!0})},onMouseLeave:function(){return e.setState({highlight:!1})},style:this.state.canvasCb?{cursor:"crosshair",backgroundColor:"white"}:{}},r.a.createElement("g",{ref:this.canvas},this.panzoom&&this.renderStep(this.state.currentStep))),r.a.createElement(H,{currentStep:this.state.currentStep,stepInfo:this.state.steps,setStep:function(t){return e.setState({currentStep:t,interaction:t===e.state.steps.length-1})},state:this.state,setState:function(t,n,a){e.setState({changeHistory:t,steps:n,redoHistory:a,currentStep:n.length-1})}})))}}]),n}(r.a.Component),Q=(n(60),function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={premises:[""],conclusion:""},a.handleChange.bind(Object(u.a)(a)),a.removePremise.bind(Object(u.a)(a)),a.verify=a.verify.bind(Object(u.a)(a)),a.create=a.create.bind(Object(u.a)(a)),a.filename=r.a.createRef(),a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){}},{key:"handleChange",value:function(e,t){if(null!=t){var n=this.state.premises;n[t]=e.target.value,this.setState({premises:n})}else this.setState({conclusion:e.target.value})}},{key:"removePremise",value:function(e){var t=this.state.premises;t.splice(e,1),this.setState({premises:t})}},{key:"verify",value:function(){var e=this.state,t=e.premises,n=e.conclusion;for(var a in t)if(""===t[a]||!t[a])return!1;return!(""===n||!n)}},{key:"create",value:function(){if(console.log("Creating..."),console.log("Verification concluded "+this.verify()),this.verify()){var e=this.state,t=e.premises,n=e.conclusion;for(var a in t)t[a]=F(t[a]),console.log(t[a]);n=F(n),this.props.setupFunc(this.filename.current.value,{premises:t,conclusion:n,steps:[]})}}},{key:"getFormulaCell",value:function(e,t){var n,a,i=this;w(e)&&(n=z(e),a=F(e));var s=r.a.createElement("td",{className:"close interactive",onClick:function(){return i.removePremise(t)}},"\u2715"),o=r.a.createElement("input",{onChange:function(e){return i.handleChange(e,t)}});return null==t&&(o=r.a.createElement("input",{onChange:function(e){return i.handleChange(e)}}),s=r.a.createElement("td",{className:"close"})),0===t&&(s=r.a.createElement("td",{className:"close"})),r.a.createElement("tr",null,r.a.createElement("td",null,o),r.a.createElement("td",null,n&&r.a.createElement(Z.a,{math:n})),r.a.createElement("td",null,a&&r.a.createElement(Z.a,{math:a})),s)}},{key:"render",value:function(){var e=this,t=this.state,n=t.premises,a=t.conclusion;return r.a.createElement("div",{className:"content full-width"},r.a.createElement("h1",null,"Create New"),r.a.createElement("h2",null,"File Name"),r.a.createElement("input",{ref:this.filename}),r.a.createElement("table",{className:"formulaTable"}),r.a.createElement("h2",null,"Premises"),r.a.createElement("table",{className:"formulaTable"},r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,"Formula"),r.a.createElement("td",null,"TeX notation"),r.a.createElement("td",null,"EG notation"),r.a.createElement("td",{className:"close"})),n.map((function(t,n){return e.getFormulaCell(t,n)})),r.a.createElement("tr",null,r.a.createElement("td",{className:"interactive",onClick:function(){return e.setState({premises:n.concat([""])})}},r.a.createElement("span",{className:"plus"}),"Add New Premise"),r.a.createElement("td",null),r.a.createElement("td",null),r.a.createElement("td",{className:"close"})))),r.a.createElement("h2",null,"Conclusion"),r.a.createElement("table",{className:"formulaTable"},r.a.createElement("tbody",null,this.getFormulaCell(a))))}}]),n}(r.a.Component)),K=(n(61),function(e){var t=e.recentDocs;return r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"column"},r.a.createElement("h1",null,"Existential Graphs"),r.a.createElement("p",null,"Using this tool, you can initialize proofs in the existential graph schema and then you can go through the process of solving them. You can save these proofs and look back at them later.")),r.a.createElement("div",{className:"divider"}),r.a.createElement("div",{className:"column"},r.a.createElement("h1",null,"Recent Proofs"),Object.keys(t).map((function(e){return r.a.createElement("div",{className:"proofField",style:{display:"flex",justifyContent:"space-between"}},r.a.createElement("span",{onClick:function(){return t[e].open()}},e),r.a.createElement("span",{style:{color:"gray"},onClick:function(){return t[e].delete()}},"Delete"))}))))}),ee=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).createView=r.a.createRef(),a.callCreate=a.callCreate.bind(Object(u.a)(a)),a.animateAway=a.animateAway.bind(Object(u.a)(a)),a.openFile=a.openFile.bind(Object(u.a)(a)),a.state={createShown:!1,floatingWindowCSS:"floating-window shown"},a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){}},{key:"animateAway",value:function(){this.setState({floatingWindowCSS:"floating-window"})}},{key:"callCreate",value:function(){this.createView.current.create()}},{key:"openFile",value:function(){var e=this,t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("accept",".egprf"),t.onchange=function(t){console.log("ONCHANGE"),t.stopPropagation(),t.preventDefault();var n=t.target.files[0];console.log(n);var a=new FileReader;a.addEventListener("load",(function(t){try{var a=JSON.parse(t.target.result);console.log(a),e.props.setupFunc(n.name.split(".egprf")[0],a)}catch(r){console.error(r),alert("Corrupt file or improper formatting.")}})),a.readAsText(n)},t.click()}},{key:"render",value:function(){var e=this,t=this.state,n=t.createShown,a=t.floatingWindowCSS;return r.a.createElement("div",{className:a},!n&&r.a.createElement(K,{recentDocs:this.props.recentDocs}),n&&r.a.createElement(Q,{setupFunc:this.props.setupFunc,ref:this.createView}),!n&&r.a.createElement("div",{className:"toolbar"},r.a.createElement("button",{onClick:function(){return e.setState({createShown:!0})}},"New"),r.a.createElement("button",{onClick:this.openFile},"Open")),n&&r.a.createElement("div",{className:"toolbar"},r.a.createElement("button",{className:"back",onClick:function(){return e.setState({createShown:!1})}},r.a.createElement("span",null,r.a.createElement(A.a,{className:"svg",src:"/existential-graphs/assets/back-caret.svg"})),"Back"),r.a.createElement("button",{onClick:this.callCreate},"Create")))}}]),n}(r.a.Component),te=window.localStorage,ne=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).createNewProof=a.createNewProof.bind(Object(u.a)(a)),a.setupProof=a.setupProof.bind(Object(u.a)(a)),a.openCanvas=a.openCanvas.bind(Object(u.a)(a)),a.saveProof=a.saveProof.bind(Object(u.a)(a)),a.getRecents=a.getRecents.bind(Object(u.a)(a)),a.introWindow=r.a.createRef(),a.state={initialCSS:"initial",canvasOpen:!1,popupOpen:!1,filename:"",proof:{premises:[],conclusion:"",steps:[]},recentDocs:a.getRecents()},console.log(a.state.recentDocs),a.menuItems=[{title:"Exit",func:function(){a.setState({initialCSS:"initial",canvasOpen:!1,popupOpen:!1,filename:"",proof:{premises:[],conclusion:"",steps:[]},recentDocs:a.getRecents()})}},"separator",{title:"Export",func:function(){var e=document.createElement("a"),t=new Blob([JSON.stringify(a.state.proof)],{type:"text/plain"});e.href=URL.createObjectURL(t),e.download=a.state.filename+".egprf",document.body.appendChild(e),e.click()}}],a}return Object(c.a)(n,[{key:"getRecents",value:function(){var e=this,t=te.getItem("recentDocs");t=t?JSON.parse(t):{};var n=Object.keys(t),a=function(a){t[n[a]].open=function(){e.setState({filename:n[a],proof:t[n[a]]}),e.openCanvas()},t[n[a]].delete=function(){var t=te.getItem("recentDocs");delete(t=t?JSON.parse(t):{})[n[a]],te.setItem("recentDocs",JSON.stringify(t)),e.setState({recentDocs:t})}};for(var r in n)a(r);return t}},{key:"saveProof",value:function(e){var t=this.state.recentDocs;return t[e]=this.state.proof,function(n){t[e]=n,te.setItem("recentDocs",JSON.stringify(t))}}},{key:"setupProof",value:function(e,t){this.setState({filename:e,proof:t}),this.openCanvas()}},{key:"openCanvas",value:function(){var e=this;this.setState({initialCSS:"initial whiteBG"}),this.introWindow.current.animateAway(),setTimeout((function(){return e.setState({canvasOpen:!0})}),1e3)}},{key:"createNewProof",value:function(){this.setState({popupOpen:!0})}},{key:"render",value:function(){return this.state.canvasOpen?r.a.createElement("div",{className:"App"},r.a.createElement(q,{menuItems:this.menuItems,saveProof:this.saveProof(this.state.filename),proof:this.state.proof})):r.a.createElement("div",{className:this.state.initialCSS},r.a.createElement(ee,{ref:this.introWindow,recentDocs:this.state.recentDocs,setupFunc:this.setupProof}))}}]),n}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(ne,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[27,1,2]]]);
//# sourceMappingURL=main.dbec2f34.chunk.js.map